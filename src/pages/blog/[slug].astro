---
import { getCollection, getEntry, render } from "astro:content";
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";

const { slug } = Astro.params;
if (!slug) throw new Error("Slug not found");
const post = await getEntry("posts", slug);

if (!post) throw new Error("No post found for this slug");
const { Content } = await post.render();

// Generate static pages
export async function getStaticPaths() {
   const posts = await getCollection("posts");
   return posts.map((post) => ({ params: { slug: post.slug } }));
}
---

<Layout title={post.data.title}>
   <article class="blog-article">
      <h1 class="blog-article__title">{post.data.title}</h1>
      <span class="blog-article__meta">
         Published on {post.data.date.toLocaleDateString()}
      </span>
      {
         post.data.cover ? (
            <Image
               src={post.data.cover}
               alt={post.data.title}
               class="blog-article__cover"
               width={1024}
               height={683}
            />
         ) : null
      }
      <div class="blog-article__content">
         <Content />
      </div>
   </article>
</Layout>

<style>
   .blog-article {
      padding: 4rem;
      font-family: sans-serif;
      color: #555;
      max-width: 80rem;
      margin: 0 auto;
   }

   .blog-article__cover {
      width: 100%;
      height: auto;
      margin-bottom: 2rem;
      border-radius: 0.5rem;
   }

   .blog-article__title {
      font-size: 3rem;
      margin-bottom: 1rem;
   }

   .blog-article__meta {
      display: block;
      font-size: 0.875rem;
      color: #666;
      margin-bottom: 1rem;
   }

   .blog-article__content {
      line-height: 1.6;
   }

   .blog-article__content img {
      max-width: 100%;
   }
</style>
